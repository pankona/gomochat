# gomochat

gomobile を使ってチャットクライアントを作ってみる

## ビルド方法

### 事前準備

* `go` コマンドが使える状態になっていること
* `gomobile` コマンドが使える状態になっていること
* Android Studio 3.0.1 がインストールされていること

### AAR 生成

* `make bind` コマンドで gomochat.aar が生成されます。

### APK 生成

* `make` で 上記の AAR 生成から apk 生成までやります。

### Android Studio でプロジェクトを読み込む

* `android` ディレクトリを Android Studio に読み込ませます。
* ビルドして APK を生成し、実機に食わせるなりエミュレータに食わせるなりします。

## アプリの説明

簡易なチャットアプリです。

### サーバを立てる

* `gomochat/cmd/server` 以下に、サーバのソースコードが格納されています。
  * `gorilla/websocket/example` 以下の `chat` と同じものです。
  * 当該ディレクトリに行き、`go build` でサーバ実行バイナリが生成されます。

### クライアント (cli) を接続する

* `gomochat/cmd/gomochat` 以下に、延々とメッセージ受信送信を繰り返すだけのアプリが格納されています。
  * 当該ディレクトリに行き、`go build` でクライアントの実行バイナリが生成されます。
  * あらかじめサーバを起動しておき、本クライアントを実行します。WebSocket が接続され、メッセージの送受信が始まります。
  * メッセージは、接続中のクライアント全ての転送されます。

### クライアント (Android アプリ) を接続する

* `gomochat/android` を Android Studio で読み込みます。
* `MainActivity.kt` 内に接続先のアドレスがハードコーディングされているので、  
上記で立てたサーバの IP アドレスに修正し、ビルドします。
* 生成した APK を、実機、ないしエミュレータにインストールします。
* アプリは起動すると自動的にサーバに接続しようとします。
* 名前、メッセージを入力する欄があるので、入力し、SEND ボタンを押すとメッセージを送信します。
  * メッセージは、接続中のクライアント全ての転送されます。

## LICENSE

* `gomochat/cmd/server` のソースコードは `gorilla/websocket` のライセンスに従います。
* その他は MIT です。


